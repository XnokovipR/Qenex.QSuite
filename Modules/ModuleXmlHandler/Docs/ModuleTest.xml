<?xml version="1.0" encoding="utf-8"?>
<module name="UnifiedModule" label="Test module">
    <description>This is a test module</description>
    <version>1.0.0</version>
    <author>Qenex</author>
    <company>QENEX Ltd.</company>
    <createdOn>2024-11-27</createdOn>
    
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Module Relations                                  +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <driverReferences>
        <driverReference ref="SimulDataDriver" label="Simulation driver">
            <isEnabled>true</isEnabled>
            <settings>periodes=1</settings>
            <encryptedSettings/>
            <protocolReferences>
                <protocolReference ref="SimpleO2OProtocol">
                    <settings/>
                    <encryptedSettings/>                   
                    <variableReferences>
                        <variableReference ref="1" isCommunicated="true">
                            <commParam>direction="read";eventRef="Event1s";multiplier="1";id="OilTemp"</commParam>
                        </variableReference>
                        <variableReference ref="2" isCommunicated="true">
                            <commParam>direction="read";eventRef="Event1s";multiplier="1";id="OilPressure"</commParam>
                        </variableReference>
                        <variableReference ref="3" isCommunicated="true">
                            <commParam>direction="read";eventRef="Event1s";multiplier="2";id="MachineState"</commParam>
                        </variableReference>
                    </variableReferences>
                </protocolReference>
            </protocolReferences>
        </driverReference>
<!--        <driverReference ref="ZeroMQServerDriver" label="ZeroMQ server driver">-->
<!--            <isEnabled>true</isEnabled>-->
<!--            <settings>127.0.0.1:5000</settings>-->
<!--            <encryptedSettings/>-->
<!--            <protocolReferences>-->
<!--                <protocolReference ref="SimpleO2OProtocol">-->
<!--                    <variableReferences>-->
<!--                       <variableReference ref="1" isCommunicated="true">-->
<!--                            <commParam>direction="read";eventRef="Event100ms";multiplier="1";id="OilTemp"</commParam>-->
<!--                        </variableReference>-->
<!--                        <variableReference ref="2" isCommunicated="true">-->
<!--                            <commParam>direction="read";eventRef="Event2s";multiplier="1";id="OilPressure"</commParam>-->
<!--                        </variableReference>-->
<!--						<variableReference ref="3" isCommunicated="true">-->
<!--							<commParam>direction="read";eventRef="OnRequestEvent1";multiplier="2";id="MachineState"</commParam>-->
<!--						</variableReference>-->
<!--                    </variableReferences>-->
<!--                </protocolReference>-->
<!--            </protocolReferences>-->
<!--        </driverReference>-->
<!--        <driverReference ref="ZeroMQClientDriver" label="My Ethernet client driver">-->
<!--            <isEnabled>true</isEnabled>-->
<!--            <settings>127.0.0.1:5001</settings>-->
<!--            <encryptedSettings/>-->
<!--            <protocolReferences>-->
<!--                <protocolReference ref="Simple One to One Protocol">-->
<!--                    <variableReferences>-->
<!--&lt;!&ndash;                        <variableReference ref="4" isCommunicated="true"/>&ndash;&gt;-->
<!--                    </variableReferences>-->
<!--                </protocolReference>-->
<!--        </protocolReferences>-->
<!--    </driverReference>  -->
<!--        <driverReference ref="PeakCANDriver" label="My PEAK-CAN driver">-->
<!--        <isEnabled>true</isEnabled>-->
<!--        <settings>CAN-FD;500kbps</settings>-->
<!--        <encryptedSettings>440</encryptedSettings>-->
<!--        <protocolReferences>-->
<!--            <protocolReference ref="XCP Protocol">-->
<!--                <variableReferences>-->
<!--                    <variableReference ref="5" isCommunicated="true">-->
<!--                        <commParam>direction="read";eventRef="Event2s";multiplier="1";address="22"</commParam>-->
<!--                    </variableReference>-->
<!--                </variableReferences>-->
<!--            </protocolReference>-->
<!--        </protocolReferences>-->
<!--    </driverReference>        -->
    </driverReferences>
    
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Drivers                                           +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <drivers>
        <driver id="1" name="SimulDataDriver">
            <version>1.0.0</version>
        </driver>
        <driver id="2" name="ZeroMQServerDriver">
            <version>1.0.0</version>
        </driver>        
        <driver id="3" name="ZeroMQClientDriver">
            <version>1.0.0</version>
        </driver>
        <driver id="4" name="PeakCANDriver">
            <version>1.0.0</version>
        </driver>
    </drivers>
    
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Protocols                                         +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <protocols>
        <protocol id="1" name="SimpleO2OProtocol" label="Simple one to one protocol">
            <version>1.0.0</version>
        </protocol>
        <protocol id="2" name="XCP Protocol" label="XCP protocol">
            <version>1.0.0</version>
        </protocol>
    </protocols>

    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Presentations                                     +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <presentations>
        <presentation name="IntTemperature" label="Temperature" min="0" max="1000" printFormat="%.2f" unit="°C">
            <conversionReference ref="OneToOne"/>
        </presentation>
        <presentation name="FloatPressure" label="Pressure" min="0" max="1000" printFormat="%.3f" unit="Pa">
            <conversionReference ref="OneToOne"/>
        </presentation>
        <presentation name="EngineState" label="Engine state" unit="">
            <conversionReference ref="EngineState"/>
        </presentation>
    </presentations>

    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Conversions                                       +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <conversions>
        <linearConversion name="OneToOne" multiplier="1" offset="0"/>
        <enumConversion name="EngineState">
            <enums>
                <enum name="Stopped" value="0"/>
                <enum name="Starting" value="1"/>
                <enum name="Running" value="2"/>
                <enum name="Stopping" value="3"/>
            </enums>
        </enumConversion>
    </conversions>

    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Periodic events, others are not defined in xml    +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->   
    <variableEvents>
        <periodicVariableEvent name="Event100ms" period="100" unit="Milisec"/>
        <periodicVariableEvent name="Event2s" period="2" unit="Sec"/>
        <periodicVariableEvent name="Event1s" period="1" unit="Sec"/>
		<onRequestVariableEvent name="OnRequestEvent1"/>
		<onValueChangedVariableEvent name="OnValueChangedEvent1" threshold="3.14"/>
		<onValueChangedVariableEvent name="OnValueChangedEvent2" threshold="10"/>
    </variableEvents>

    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--+           Variables                                         +-->
    <!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <variables>
        <scalarVariable id="1" namespace="/Engine" name="OilTemp" label="Oil Temperature" size="4">
            <description>Oil Temperature </description>
            <values dataType="int" size="4" length="1">
                <presentationReference ref="IntTemperature"/>
            </values>
        </scalarVariable>
        <scalarVariable id="2" namespace="/Engine" name="OilPressure" label="Oil Pressure" size="4">
            <description>Oil pressure</description>
            <values dataType="float" size="4" length="1">
                <presentationReference ref="FloatPressure"/>
            </values>
        </scalarVariable>
        <scalarVariable id="3" namespace="/" name="MachineState" label="Machine state" size="1">
            <description>Main machine enum states</description>
            <values dataType="byte" size="1" length="1">
                <presentationReference ref="EngineState"/>
            </values>
        </scalarVariable>
        <stringVariable id="4" namespace="/Info" name="AlertMsg" label="Alert Message">
            <description>Details about warnings/errors</description>
        </stringVariable>
        <scalarVariable id="5" namespace="/Inlet" name="AirPressure" label="Air Pressure" size="4">
            <description>Air pressure</description>
            <values dataType="float" size="4" length="1">
                <presentationReference ref="FloatPressure"/>
            </values>
        </scalarVariable>
    </variables>
</module>